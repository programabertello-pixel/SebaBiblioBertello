const path = require('path'); const fs = require('fs'); const Database = require('better-sqlite3'); const dbFile = path.join(__dirname,'..','db','library.db'); function init(){ const dir = path.dirname(dbFile); if(!fs.existsSync(dir)) fs.mkdirSync(dir,{recursive:true}); const db = new Database(dbFile); const schema = fs.readFileSync(path.join(__dirname,'..','db','schema.sql'),'utf8'); db.exec(schema); const row = db.prepare("SELECT value FROM meta WHERE key='install_ts'").get(); if(!row) db.prepare("INSERT OR REPLACE INTO meta(key,value) VALUES('install_ts', ?)").run(new Date().toISOString()); return db; } module.exports = { init };